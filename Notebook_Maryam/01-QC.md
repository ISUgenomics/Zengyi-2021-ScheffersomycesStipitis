# QC

* Jan 14, 2021
* Nova:

Soft linking raw data :
```bash
cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData



```

* Metadata : "/wor
k/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/1585-Barcode layout "


1585 Barcodes
|sample|	barcode|
|---|---|
|6	|13|
|NC-22	|14|
|N29	|15|
|53	|16|
|55	|17|
|59	|18|
|88	|19|


```bash
module load gcc/7.3.0-xegsmw4
module load nextflow

module load singularity
nextflow run ../../../Programfiles/nanoQCtrim --fastqs  ../00-RawData/barcode13/FAO68114_pass_barcode13_598c81f2_*.fastq

```

I asked Andrew and there were several problems with the way I wanted to run it !
1. I need to run `/work/gif/Maryam/Programfiles/nanoQCtrim/main.nf` !
2. I need `nova` profile so the jobs are submitted and `singularity` to load the singularity module and pull the containers.
3. Andrew suggested that I concatenate the fastq files for each system and run but everything was so quick and easy that I decided to run as it is.


The correct command :
```nextflow run /work/gif/Maryam/Programfiles/nanoQCtrim/main.nf --fastqs ../00-RawData/barcode13/FAO68114_pass_barcode13_598c81f2_*.fastq --outdir output-barcode13 -profile singularity,nova
```

This was finished very fast ( less than a minute). So I decided to just submit all of them jobs from a loop file:

```bash
for n in 4 5 6 7 8 9
 do
 nextflow run /work/gif/Maryam/Programfiles/nanoQCtrim/main.nf --fastqs ../00-RawData/barcode1$n/FAO68114_pass_barcode1$n_598c81f2_*.fastq --outdir output-barcode1$n -profile singularity,nova
 done
```
All the jobs finished quickly.



It seems there is a problem.
It could be that I needed to  concatenate the input files. Lets try again..

```bash
cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode13
cat FAO68114_pass_barcode13_598c81f2_*.fastq > conbine-barcode13.fastq
grep "@" conbine-barcode13.fastq | wc
 312697 1720486 1434928828

cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode14
cat FAO68114_pass_barcode14_598c81f2_*.fastq > conbine-barcode14.fastq

grep "@" conbine-barcode14.fastq | wc
 172770  950307 985306927

cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode15
cat FAO68114_pass_barcode15_598c81f2_*.fastq > conbine-barcode15.fastq

cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode16
cat FAO68114_pass_barcode16_598c81f2_*.fastq > conbine-barcode16.fastq

cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode17
cat FAO68114_pass_barcode17_598c81f2_*.fastq > conbine-barcode17.fastq
grep "@" conbine-barcode17.fastq | wc
  62812  345511 414268224

cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode18
cat *.fastq > conbine-barcode18.fastq
grep "@" conbine-barcode18.fastq | wc
 300936 1655580 1298964855

cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/00-RawData/1585/1585/1585/20201222_2025_X1_FAO68114_96355fd8/fastq_pass/barcode19
cat *.fastq > conbine-barcode19.fastq
grep "@" conbine-barcode19.fastq | wc
  80876  444863 465828992
```
There is a problem with downpore. Here is what Andrew thinks about the issue :

*
*
*

So Andrew made some changes in the pipeline.

##### barcode 13

I am trying the pipeline again:

```bash
cd /work/gif/Maryam/projects/Zengyi-2021-ScheffersomycesStipitis/01-QC

nextflow run ../../../Programfiles/nanoQCtrim --fastqs  ../00-RawData/barcode13/conbine-barcode13.fastq --outdir output-barcode13-fixed -profile singularity,nova
```

* error message:
`  2021/01/19 21:32:02 Splitting read  22601  into: 0 - 1017 and 1277 - 1819
executor >  slurm (3)
[-        ] process > runNanoPlot (1) -
[2a/26ed91] process > getAdapters     [100%] 1 of 1 ✔
[f1/2a91bc] process > runDownPore (1) [100%] 1 of 1, failed: 1 ✘
Error executing process > 'runDownPore (1)
Caused by:
  Process "runDownPore (1)" terminated with an error exit status (2)
`

It seems that the complain is about `read 22601`. I am going to delete this read and run again.

The new file is called `combine-barcode13-fixedReads.fastq`


I repeat and still have some problems. It seems that at least in some of the fastq files there are more than one read with problems.

Next read to be deleted: `read 21822`.
I still get the error message after deleting that read:
`2021/01/20 15:07:16 Splitting read  21822  into: 0 - 903 and 1131 - 1048
  2021/01/20 15:07:16 CGTACCGGTGCTGTCACACGAGTATGGA
  panic: runtime error: slice bounds out of range  
`
I am not sure why. I am going to leave this for now and try complete match for finding adaptors. This way it is possible that most of the adaptors are not trimmed but they might not influence the assembly. After assembly is done we can confirm that the adaptors are not in the assembly later.

For now:

```bash
nextflow run /work/gif/Maryam/Programfiles/nanoQCtrim/main.nf --fastqs ../00-RawData/barcode13/combine-barcode13.fastq   --outdir output-barcode13  --options '-middle_threshold 100' -profile nova,singularity

```

running nanoQCtrim for the rest of barcodes in a for loop:
```bash
for n in 4 5 6 7 8 9 ; do   nextflow run /work/gif/Maryam/Programfiles/nanoQCtrim/main.nf --fastqs ../00-RawData/barcode1$n/combine-barcode1$n.fastq   --outdir output-barcode1$n  --options '-middle_threshold 100' -profile nova,singularity; done
```
